# F002 - Imp (小惡魔)

> **卡片設計文件（SDD - Software Design Document）**
> 版本：1.0.0
> 設計者：Claude + User
> 設計日期：2025-01-01

---

## 📋 基本資訊

| 屬性 | 值 | 說明 |
|------|-----|------|
| **卡片 ID** | F002 | Fire 家族第二張卡 |
| **英文名稱** | Imp | 小惡魔、淘氣鬼 |
| **中文名稱** | 小惡魔 | 繁體中文名稱 |
| **元素** | FIRE | 火元素 |
| **費用 (Cost)** | 1 | 低費卡片 |
| **基礎分數** | 2 | 低分數 |
| **稀有度** | Common | 常見卡片 |

---

## 🎴 卡片效果

### 主效果：馴服時獲得石頭

**效果類型**：`EffectType.EARN_STONES`

**觸發時機**：`EffectTrigger.ON_TAME` (馴服時觸發)

**效果數值**：3 個 1 點石頭

**效果描述**：
- **英文**：Earn 1 1 1.
- **中文**：獲得 3 個 1 點石頭。

### 次要效果：可被回收

**效果類型**：`EffectType.RECOVER_CARD`

**觸發時機**：`EffectTrigger.PERMANENT` (永久效果)

**效果描述**：
- **英文**：Recover.
- **中文**：可被回收。

---

## 🎯 設計理念

### 遊戲定位

- **類型**：早期經濟卡 + 循環組件
- **時機**：早期馴服，提供即時石頭收益
- **策略**：適合配合回收系統，重複觸發效果

### 設計靈感

**神話背景**：
- Imp 是傳說中的小惡魔、使魔
- 雖然力量弱小，但忠誠且可靠
- 在遊戲中代表「小但實用」的資源

**機制設計**：
- **雙效果設計**：即時收益 + 長期價值
- **ON_TAME 效果**：馴服時立即獲得 3 點石頭（回本還賺）
- **可回收機制**：配合其他卡片形成循環組合

### 平衡性考量

**為什麼 Cost 1？**
- 低費卡片易於早期馴服
- 馴服費用僅 1 點，立即獲得 3 點石頭（淨收益 +2）

**為什麼 Base Score 只有 2？**
- 即時石頭收益已經很強
- 可回收特性提供額外價值
- 需要用低分數平衡強力效果

**為什麼給 3 個 1 點石頭而不是其他組合？**
- 3 個小石頭比 1 個大石頭更靈活
- 可以分別使用，策略選項更多
- 符合「小惡魔」的主題

**與同 Cost 卡片比較**：
| 卡片 | Cost | Score | 效果價值 | 總 EV |
|------|------|-------|---------|-------|
| F002 Imp | 1 | 2 | +3 石頭 + 可回收 | ~4-5 |
| F003 Succubus | 1 | 4 | +0-10 分（條件） | 4-14 |
| F004 Firefox | 1 | 3 | +0-10 石頭（手牌數） | 3-13 |
| F005 Salamander | 1 | 2 | +4 石頭/回合 | 22-42（過強） |

---

## ⚙️ 實作規格

### 資料結構

```typescript
{
  id: 'F002',
  name: 'Imp',
  nameTw: '小惡魔',
  element: Element.FIRE,
  cost: 1,
  baseScore: 2,
  effects: [
    {
      type: EffectType.EARN_STONES,
      trigger: EffectTrigger.ON_TAME,
      stones: [{ type: StoneType.ONE, amount: 3 }],
      description: 'Earn 1 1 1.',
      descriptionTw: '獲得 3 個 1 點石頭。',
    },
    {
      type: EffectType.RECOVER_CARD,
      trigger: EffectTrigger.PERMANENT,
      description: 'Recover.',
      descriptionTw: '可被回收。',
    },
  ],
  flavorText: 'Small but mischievous.',
  flavorTextTw: '頑皮的火焰精靈，雖然弱小但忠誠。',
  imageUrl: '200px-Imp.webp',
}
```

### 效果處理邏輯

#### 效果 1：EARN_STONES (ON_TAME)

**觸發時機**：
- [x] `ON_TAME` - 馴服時觸發 ✅ **使用此時機**
- [ ] `PERMANENT` - 永久生效
- [ ] `ON_SCORE` - 計分時觸發

**處理流程**：
```
1. 檢查觸發條件
   - 卡片剛被馴服（從市場/手牌移到場上）
   - 效果類型為 EARN_STONES
   ↓
2. 計算效果數值
   - 從 effect.stones 取得 [{ type: ONE, amount: 3 }]
   ↓
3. 更新玩家石頭池
   - player.stones.ONE += 3
   ↓
4. 返回效果結果
   - success: true
   - message: "獲得 3 個 1 點石頭"
   - stonesGained: { ONE: 3 }
```

#### 效果 2：RECOVER_CARD (PERMANENT)

**觸發時機**：
- [ ] `ON_TAME` - 馴服時觸發
- [x] `PERMANENT` - 永久生效 ✅ **使用此時機**
- [ ] `ON_SCORE` - 計分時觸發

**處理流程**：
```
1. 檢查觸發條件
   - 卡片在玩家場上（field）
   - 效果類型為 RECOVER_CARD
   ↓
2. 標記卡片狀態
   - card.isRecoverable = true
   ↓
3. 提供回收介面
   - 其他回收卡片（如 Asmodeus）可觸發
   ↓
4. 執行回收時
   - 從場上移到手牌
   - 可重新馴服（重新觸發 ON_TAME 效果）
```

### 狀態變更

| 變更項目 | 變更方式 | 時機 |
|---------|---------|------|
| player.stones.ONE | +3 | 馴服時（ON_TAME） |
| card.isRecoverable | true | 場上時（PERMANENT） |
| card.location | FIELD → HAND | 被回收時 |

### 邊界條件處理

| 情境 | 處理方式 |
|------|---------|
| 石頭池已滿（達上限） | 仍可獲得石頭，超過上限部分丟棄 |
| 卡片被棄牌（不是回收） | 失去可回收狀態 |
| 多次回收同一張 Imp | 每次馴服都觸發 ON_TAME 效果 |
| 場上無回收卡片 | RECOVER_CARD 效果無實際作用 |

---

## 🧪 測試案例

### 單元測試

#### 1. 卡片資料完整性測試

- [ ] ✅ 卡片 ID 正確為 'F002'
- [ ] ✅ 英文名稱為 'Imp'
- [ ] ✅ 中文名稱為 '小惡魔'
- [ ] ✅ 元素為 Element.FIRE
- [ ] ✅ Cost 為 1
- [ ] ✅ Base Score 為 2
- [ ] ✅ 有 2 個效果
- [ ] ✅ 第一效果類型為 EARN_STONES (ON_TAME)
- [ ] ✅ 第二效果類型為 RECOVER_CARD (PERMANENT)
- [ ] ✅ 石頭配置正確（3 個 ONE）

#### 2. 效果邏輯測試

**測試案例 1**：馴服時獲得石頭
```typescript
// Given: 玩家石頭池為空
// When: 馴服 Imp 卡
// Then: 玩家獲得 3 個 1 點石頭
```

**測試案例 2**：可回收標記
```typescript
// Given: Imp 在玩家場上
// When: 檢查卡片狀態
// Then: isRecoverable 為 true
```

**測試案例 3**：回收後重新馴服
```typescript
// Given: Imp 在場上（已獲得 3 點石頭）
// When: 回收到手牌，再次馴服
// Then: 再次獲得 3 個 1 點石頭（總計 +6）
```

### 整合測試

#### 1. 與遊戲系統整合

- [ ] ✅ 能正確加入牌庫
- [ ] ✅ 能正確被抽取到市場
- [ ] ✅ 能正確被馴服到場上
- [ ] ✅ ON_TAME 效果正確觸發
- [ ] ✅ PERMANENT 效果標記生效
- [ ] ✅ 計分時正確計入 2 分

#### 2. 與其他卡片組合

**組合案例 1**：與 F013 Asmodeus 組合
- **情境**：場上有 Imp + Asmodeus
- **預期**：Asmodeus 可回收 Imp（符合 cost ≤2 且有即時效果）
- **結果**：Imp 回到手牌，可重新馴服

**組合案例 2**：與 F014 Balog 組合
- **情境**：場上有 Imp + Balog
- **預期**：Balog 不能回收 Imp（Imp 只有 2 分，不是 6 分卡）
- **結果**：無法回收

**組合案例 3**：與 F001 Hestia 組合
- **情境**：先馴服 Hestia（上限 +2），再馴服 Imp
- **預期**：Imp 產出的 3 個石頭可以全部持有（不超上限）
- **結果**：石頭池正確更新

### E2E 測試

- [ ] ✅ 完整遊戲流程：市場 → 馴服 → 獲得石頭 → 計分
- [ ] ✅ 回收循環：馴服 → 回收 → 重新馴服 → 再次獲得石頭
- [ ] ✅ 與 AI 對戰：AI 能正確評估 Imp 的價值
- [ ] ✅ 多人模式：回收機制正確處理

---

## 🎨 UI/UX 需求

### 卡片視覺設計

```
┌──────────────────┐
│   [Fire Icon]    │  ← 火元素圖示
│                  │
│     [Image]      │  ← Imp 插圖（淘氣表情）
│     小惡魔        │
│                  │
│  Cost: 1  📊 2   │  ← 費用 & 分數
│                  │
│  ┌────────────┐  │
│  │ 💎 獲得石頭 │  │  ← 效果 1 圖示
│  │  1 1 1     │  │
│  │ ♻️ 可回收   │  │  ← 效果 2 圖示
│  └────────────┘  │
│                  │
│  頑皮的火焰精靈  │  ← 風味文字
│  ，雖然弱小但   │
│  忠誠。         │
└──────────────────┘
```

### 視覺資源

| 資源 | 檔案名稱 | 尺寸 | 說明 |
|------|---------|------|------|
| 卡片圖片 | `200px-Imp.webp` | 200x280 | 小惡魔插圖 |
| 效果圖示 1 | `earn-stones.svg` | 32x32 | 獲得石頭圖示 |
| 效果圖示 2 | `recover.svg` | 32x32 | 回收圖示 |
| 元素圖示 | `fire.svg` | 24x24 | 火元素圖示 |

### 互動設計

#### Hover 效果
- 顯示完整效果說明
- 高亮「可回收」標記
- 顯示回收組合建議（如有 Asmodeus）

#### 點擊效果
- 選擇卡片時邊框高亮
- 播放選擇音效
- 顯示可執行動作（馴服/回收）

#### 特殊效果
- **馴服時**：石頭飛入石頭池動畫
- **回收時**：卡片飛回手牌動畫
- **場上時**：卡片右上角顯示♻️圖示

---

## 📊 平衡性數據

### 期望價值計算

```
即時價值 = Base Score + ON_TAME 效果
        = 2 + 3 點石頭
        = 2 + 3
        = 5 點價值

馴服成本 = 1 點石頭

淨收益 = 5 - 1 = 4 點

回收價值 = 可重複觸發（視回收次數）
          每次回收 = +3 點石頭

總期望價值（1 次回收）= 2 分 + 3 石頭 + 3 石頭
                      = 2 + 6
                      = 8 點
```

### 與同類卡片比較

| 卡片 | Cost | Score | 效果 | 即時價值 | 回收潛力 |
|------|------|-------|------|---------|---------|
| F002 Imp | 1 | 2 | +3 石頭 + 可回收 | 5 | 高（可重複） |
| F003 Succubus | 1 | 4 | +0-10 分（條件） | 4-14 | 無 |
| F004 Firefox | 1 | 3 | +0-10 石頭（手牌） | 3-13 | 無 |

### 使用率預測

- **預期使用率**：High (70-80%)
- **適合策略**：
  - 早期經濟建立
  - 回收循環組合（Imp + Asmodeus）
  - 石頭密集型策略
- **反制策略**：
  - 快攻（不給時間多次回收）
  - 阻止對手取得回收卡片

---

## 🔄 回收系統設計

### 回收機制

**觸發回收的卡片**：
1. **F013 Asmodeus**：回收 cost ≤2 且有即時效果的卡片
   - ✅ Imp 符合條件（cost 1, 有 ON_TAME 效果）

2. **F014 Balog**：回收 6 分且有即時效果的卡片
   - ❌ Imp 不符合（只有 2 分）

### 回收流程

```
1. 玩家在場上有 Imp（isRecoverable = true）
   ↓
2. 玩家馴服 Asmodeus
   ↓
3. Asmodeus 效果觸發：選擇可回收的卡片
   ↓
4. 玩家選擇 Imp
   ↓
5. Imp 從 FIELD 移到 HAND
   ↓
6. 玩家可再次馴服 Imp
   ↓
7. ON_TAME 效果再次觸發（再獲得 3 個 1 點石頭）
```

### 回收價值計算

| 回收次數 | 累計石頭收益 | 累計分數 | 總成本 |
|---------|-------------|---------|--------|
| 0（單次） | +3 | 2 | 1 |
| 1 | +6 | 2 | 2 |
| 2 | +9 | 2 | 3 |
| 3 | +12 | 2 | 4 |

**結論**：每次回收都有淨收益 +2 石頭

---

## 📝 開發備註

### 已知問題
- 回收系統需要確保 UI 清楚顯示可回收卡片

### 待討論事項
- 是否限制單場遊戲的最大回收次數？
  - 目前設計：無限制
  - 建議：允許，因為需要回收卡片配合

### 未來優化方向
- 增加回收動畫效果
- 顯示回收組合建議（UI 提示）

---

## 📚 相關資料

### 參考文件
- [卡片開發指南](../../../docs/cards/CARD_DEVELOPMENT_GUIDE.md)
- [效果系統文件](../../../docs/specs/GAME_ENGINE_SPEC.md)
- [F001 Hestia 範例](../F001-Hestia/README.md)

### 相關卡片
- F013 Asmodeus - 可回收 Imp 的卡片
- F001 Hestia - 提升石頭上限，配合 Imp 產出

### 外部參考
- [Imp - Wikipedia](https://en.wikipedia.org/wiki/Imp)
- [使魔傳說](https://zh.wikipedia.org/wiki/%E4%BD%BF%E9%AD%94)

---

## 📋 開發檢查清單

### 設計階段
- [x] 設計理念明確
- [x] 效果規格清楚
- [x] 平衡性已評估
- [x] 測試案例已規劃
- [x] 回收系統設計完成

### 實作階段
- [ ] 卡片定義完成
- [ ] EARN_STONES 效果實作完成
- [ ] RECOVER_CARD 效果實作完成
- [ ] 已註冊到系統
- [ ] 程式碼已審查

### 測試階段
- [ ] 單元測試通過
- [ ] 整合測試通過
- [ ] 回收循環測試通過
- [ ] 覆蓋率達標 (>= 80%)

### 驗收階段
- [x] 文件完整
- [ ] 程式碼符合規範
- [ ] 測試全部通過
- [ ] 已進行程式碼審查
- [ ] 版本號已標記

---

## 📅 版本歷史

### v1.0.0 (2025-01-01)
- 初版設計
- 定義雙效果機制
- 設計回收系統互動
- 平衡性分析完成

---

## 👤 設計者資訊

- **設計者**：Claude + User
- **審查者**：game-balance-designer agent
- **批准者**：待定
- **設計日期**：2025-01-01
- **最後更新**：2025-01-01

---

> **Imp 是火家族中重要的經濟與循環卡片，適合配合回收機制打出強大組合！**
